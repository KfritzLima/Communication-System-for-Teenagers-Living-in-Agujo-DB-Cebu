<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<div class="forum-wrapper">
  <!-- Header -->
  <header class="forum-header">
    <div class="header-left">
      <img src="assets/images/logo-light-transparent.png" alt="Agujo Forum Logo" class="logo-image" />
    </div>

    <nav class="header-center nav-icons">
      <a href="#" title="Home" (click)="refreshPage($event)">
        <i class="fas fa-house nav-icon"></i>
      </a>
      <a href="#" title="Notifications" (click)="toggleNotifications($event)">
        <i class="fas fa-bell nav-icon"></i>
      </a>
    </nav>

    <div class="header-right">
      <div class="menu-wrapper" (click)="toggleMenu()" tabindex="0">
        <img [src]="userProfileImage || 'assets/images/default-user.webp'" alt="Profile" class="profile-pic" />
        <div class="menu-dropdown" *ngIf="showMenu">
          <button (click)="goToProfile()"><i class="fas fa-user"></i> Profile</button>
          <button (click)="goToSettings()"><i class="fas fa-cog"></i> Settings</button>
          <button class="logout-btn" (click)="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Notifications -->
  <div class="notifications-dropdown" *ngIf="showNotifications">
    <p *ngIf="notifications.length === 0">No new notifications</p>
    <ul *ngIf="notifications.length > 0">
      <li *ngFor="let notification of notifications">
        <div class="notification-message">{{ notification.message }}</div>
        <div class="notif-timestamp">{{ notification.timestamp | date: 'short' }}</div>
      </li>
    </ul>
  </div>

  <!-- Welcome Message -->
  <div class="welcome-msg" *ngIf="welcomeVisible">
    <i class="fas fa-hand-sparkles waving-icon"></i>
    <span class="welcome-text">Welcome , {{ fullName }}!</span>
  </div>

  <!-- ‚úÖ Wrapped & Centered Post Input -->
  <div class="post-input-wrapper">
    <div class="post-input" [ngClass]="{ 'with-photo': postImagePreview }">
      <img [src]="userProfileImage || 'assets/user.webp'" alt="Profile" class="profile-pic" />

      <div class="post-content-box">
        <div class="input-row">
          <label class="upload-photo" title="Attach Photo">
            <i class="fas fa-camera"></i>
            <input type="file" accept="image/*" (change)="handlePostImage($event)" />
          </label>
          <textarea
            [(ngModel)]="newPost"
            maxlength="280"
            placeholder="What's on your mind? (Max 280 characters)"
          ></textarea>
        </div>

        <div class="image-preview" *ngIf="postImagePreview">
          <img [src]="postImagePreview" alt="Post Preview" />
          <button class="remove-image" (click)="removePostImage()" title="Remove Image">
            <i class="fas fa-times-circle"></i>
          </button>
        </div>

        <button class="post-btn" (click)="submitPost()">Post</button>
      </div>
    </div>
  </div>

  <!-- Post Feed -->
  <p *ngIf="posts.length === 0" class="empty-state">No posts yet. Be the first to share!</p>

  <div class="post-list">
    <div class="post-card" *ngFor="let post of posts">
      <div class="post-header">
        <img [src]="post.profileImage || 'assets/user.webp'" alt="{{ post.author }}" class="profile-pic" />
        <div>
          <strong>{{ post.author }}</strong><br />
          <span class="timestamp">{{ post.timestamp | date: 'short' }}</span>
        </div>
      </div>

      <p class="post-location" *ngIf="post.location">Location: {{ post.location }}</p>
      <img *ngIf="post.image" [src]="post.image" class="post-image" alt="Post image" />
      <p class="post-content">{{ post.content }}</p>

      <div class="post-actions">
        <button [class.active]="post.userLiked" (click)="toggleLike(post)">
          <i class="fas fa-thumbs-up"></i> {{ post.likes }}
        </button>
        <button [class.active]="post.userReaction === 'love'" (click)="reactToPost(post, 'love')">
          ‚ù§Ô∏è {{ post.reactions.love }}
        </button>
        <button [class.active]="post.userReaction === 'laugh'" (click)="reactToPost(post, 'laugh')">
          üòÇ {{ post.reactions.laugh }}
        </button>
        <button [class.active]="post.userReaction === 'fire'" (click)="reactToPost(post, 'fire')">
          üî• {{ post.reactions.fire }}
        </button>
        <button (click)="sharePost(post)">
          <i class="fas fa-share"></i>
          <span *ngIf="post.sharedCount">({{ post.sharedCount }})</span>
        </button>
      </div>

      <div class="comment-box">
        <input [(ngModel)]="post.newComment" placeholder="Write a comment..." class="comment-input" />
        <button class="comment-btn" (click)="addComment(post)">Comment</button>

        <div class="comments-list" *ngIf="post.comments?.length">
          <div class="comment" *ngFor="let comment of post.comments">
            <strong>{{ comment.author }}:</strong> {{ comment.text }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
